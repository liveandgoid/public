<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'Or√©al Reporting Enablement Dashboard</title>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            /* Corporate Identity */
            --primary-blue: #1F3B6B;
            --accent-teal: #2BAE9F;
            --bg-light: #F5F8FA;
            --bg-white: #FFFFFF;
            --text-main: #333333;
            --text-muted: #666666;
            --border-color: #E1E8ED;
            
            /* Status Indicators */
            --trend-up: #28a745;
            --trend-down: #dc3545;
            --neutral: #6c757d;

            --font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-light);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            padding-bottom: 60px;
        }

        /* --- Header --- */
        header {
            background: var(--bg-white);
            padding: 15px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.03);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .brand-area h1 {
            font-size: 1.3rem;
            color: var(--primary-blue);
            margin: 0;
            font-weight: 700;
        }

        .brand-area span {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .meta-tag {
            background: #e3f2fd;
            color: #0d47a1;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            border: 1px solid #bbdefb;
        }

        /* --- Layout --- */
        .container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 20px;
        }

        /* --- Filters --- */
        .filter-bar {
            background: var(--bg-white);
            padding: 15px 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.02);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .filter-label {
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--primary-blue);
            text-transform: uppercase;
        }

        select, input[type="date"] {
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9rem;
            color: var(--text-main);
            min-width: 160px;
        }

        /* Radio Buttons */
        .radio-group {
            display: flex;
            gap: 5px;
            background: #f1f3f5;
            padding: 4px;
            border-radius: 4px;
        }

        .radio-group label {
            padding: 6px 12px;
            font-size: 0.85rem;
            cursor: pointer;
            border-radius: 4px;
            color: var(--text-muted);
            transition: all 0.2s;
        }

        .radio-group input[type="radio"] { display: none; }
        .radio-group input[type="radio"]:checked + label {
            background: var(--primary-blue);
            color: white;
            font-weight: 500;
        }

        /* --- Insight Panel --- */
        .insight-panel {
            background: linear-gradient(to right, #f0f7ff, #e0f2f1);
            border: 1px solid #b3e5fc;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 30px;
        }

        .insight-panel h3 {
            font-size: 1rem;
            color: var(--primary-blue);
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .insight-list {
            margin: 0;
            padding-left: 20px;
            columns: 2; 
        }
        .insight-list li { margin-bottom: 5px; font-size: 0.9rem; }

        .disclaimer-text {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-style: italic;
            margin-top: 10px;
            border-top: 1px dashed #ccc;
            padding-top: 5px;
        }

        /* --- Sections --- */
        .section-header {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin: 30px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--accent-teal);
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        /* --- Topline KPIs --- */
        .kpi-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
            /* Mobile: 1 kolom */
            grid-template-columns: 1fr;
        }

        /* Tablet: 2 kolom */
        @media (min-width: 600px) {
            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Desktop: 4 kolom (Sesuai permintaan: 4 baris pertama, 4 baris kedua) */
        @media (min-width: 1200px) {
            .kpi-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .kpi-card {
            background: var(--bg-white);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            position: relative;
        }
        
        .kpi-title { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; font-weight: 600; }
        .kpi-val { font-size: 1.6rem; font-weight: 700; color: var(--primary-blue); margin: 8px 0; }
        .kpi-trend { font-size: 0.8rem; font-weight: 500; }
        .trend-up { color: var(--trend-up); }
        .trend-down { color: var(--trend-down); }

        .tooltip-icon {
            cursor: help;
            font-size: 0.8rem;
            color: #ccc;
            float: right;
        }

        /* --- Charts & Tables Containers --- */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .grid-1 { margin-bottom: 20px; }

        .panel-card {
            background: var(--bg-white);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        .panel-title {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* Added for responsiveness */
            gap: 10px;
        }

        .chart-wrapper { 
            position: relative; 
            height: 300px; 
            width: 100%; 
        }

        /* --- Data Tables (Agency Style) --- */
        .data-table-wrapper {
            overflow-x: auto;
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            min-width: 800px; /* Ensure table doesn't squeeze too much */
        }

        th {
            background: #f8f9fa;
            color: var(--primary-blue);
            font-weight: 600;
            padding: 12px 10px;
            text-align: left;
            border-bottom: 2px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 10; /* Ensure header stays on top */
        }

        td {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-main);
        }

        tr:nth-child(even) { background: #fdfdfd; }
        tr:hover { background: #f1f3f5; }

        .num-cell { text-align: right; font-family: 'Consolas', monospace; }
        
        /* Tier Badges */
        .tier-elite { background: #e8f5e9; color: #2e7d32; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; }
        .tier-core { background: #e3f2fd; color: #1565c0; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; }
        .tier-long { background: #fff3e0; color: #ef6c00; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; }

        /* --- Governance & Enablement --- */
        .governance-section, .enablement-section {
            background: var(--bg-white);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .accordion-header {
            padding: 15px 20px;
            cursor: pointer;
            background: #f8f9fa;
            font-weight: 600;
            color: var(--primary-blue);
            display: flex;
            justify-content: space-between;
        }

        .accordion-content {
            padding: 20px;
            display: none;
            border-top: 1px solid var(--border-color);
        }
        .accordion-content.active { display: block; }

        .def-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .def-item h4 { margin: 0 0 5px 0; color: var(--accent-teal); font-size: 0.9rem; }
        .def-item p { margin: 0; font-size: 0.8rem; color: #666; }

        .signal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        .signal-card {
            border-left: 4px solid var(--accent-teal);
            padding: 10px 15px;
            background: #fafafa;
        }
        .signal-card h5 { margin: 0 0 5px 0; font-size: 0.9rem; color: var(--primary-blue); }
        .signal-card p { margin: 0; font-size: 0.8rem; }

        /* --- Footer --- */
        footer {
            margin-top: 40px;
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-muted);
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        /* --- Custom Inputs --- */
        .inline-select {
            padding: 2px 5px;
            font-size: 0.8rem;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        /* Heatmap Grid */
        .heatmap {
            display: grid;
            grid-template-columns: 40px repeat(24, 1fr);
            gap: 1px;
            overflow-x: auto; /* Enable scroll if needed */
        }
        .hm-cell {
            aspect-ratio: 1;
            background: #eee;
            border-radius: 2px;
            min-width: 15px; /* Minimum width to maintain touch target on mobile */
        }
        .hm-label { font-size: 0.7rem; text-align: right; padding-right: 5px; align-self: center; white-space: nowrap; }
        .hm-header { font-size: 0.65rem; text-align: center; color: #999; }

        /* =========================================
           RESPONSIVE STYLES (Media Queries)
           ========================================= */
        
        /* Tablet & Mobile Breakpoint (Stacked Layout) */
        @media (max-width: 1024px) {
            .grid-2 {
                grid-template-columns: 1fr; /* Stack charts vertically */
            }
            .insight-list {
                columns: 1; /* Single column for insights */
            }
        }

        /* Mobile Specific */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .header-meta {
                align-self: flex-start;
            }
            
            .filter-bar {
                flex-direction: column;
                align-items: stretch;
            }
            .filter-group {
                width: 100%;
            }
            select, input[type="date"] {
                width: 100%;
            }
            
            /* Responsive Heatmap adjustments */
            .heatmap {
                /* Allows horizontal scroll for the grid on mobile */
                overflow-x: auto; 
                min-width: 600px; /* Force minimum width to trigger scroll */
            }
            
            /* Ensure chart wrappers maintain height on mobile */
            .chart-wrapper {
                height: 250px;
            }

            .panel-title {
                flex-direction: column;
                align-items: flex-start;
            }
            
            /* Reposition inline controls for mobile */
            .panel-title > div {
                margin-top: 10px;
                width: 100%;
            }
            .inline-select {
                width: 45%; /* Split width for comparison dropdowns */
            }
        }

    </style>
</head>
<body>

    <header>
        <div class="brand-area">
            <h1>Data Centralization & Reporting Enablement</h1>
            <span>L'Or√©al Livestream Analytics ‚Ä¢ Illustrative Example</span>
        </div>
        <div class="header-meta">
            <span class="meta-tag">Deliverable 23: Enablement Framework</span>
        </div>
    </header>

    <div class="container">

        <!-- GLOBAL FILTERS -->
        <div class="filter-bar">
            <div class="filter-group">
                <span class="filter-label">Date Range</span>
                <select id="dateFilter" onchange="updateDashboard()">
                    <option value="current">Current Month (Oct 2025)</option>
                    <option value="last">Last Month (Sep 2025)</option>
                    <option value="q3">Q3 2025</option>
                </select>
            </div>

            <div class="filter-group">
                <span class="filter-label">Platform (Required)</span>
                <div class="radio-group">
                    <input type="radio" id="p_all" name="platform" value="All" checked onchange="updateDashboard()">
                    <label for="p_all">All Platforms</label>
                    
                    <input type="radio" id="p_shopee" name="platform" value="Shopee" onchange="updateDashboard()">
                    <label for="p_shopee">Shopee</label>
                    
                    <input type="radio" id="p_tiktok" name="platform" value="TikTok" onchange="updateDashboard()">
                    <label for="p_tiktok">TikTok</label>
                </div>
            </div>

            <div class="filter-group">
                <span class="filter-label">Division</span>
                <select id="divisionFilter" onchange="updateDashboard()">
                    <option value="All">All Divisions</option>
                    <option value="CPD">CPD</option>
                    <option value="LDP">LDP</option>
                    <option value="PPD">PPD</option>
                </select>
            </div>

            <div class="filter-group">
                <span class="filter-label">Brand</span>
                <select id="brandFilter" onchange="updateDashboard()">
                    <option value="All">All Brands</option>
                    <!-- CPD -->
                    <option value="MNY">MNY</option>
                    <option value="GAR">GAR</option>
                    <option value="OAP">OAP</option>
                    <option value="3CE">3CE</option>
                    <!-- LDP -->
                    <option value="LRP">LRP</option>
                    <option value="CRV">CRV</option>
                    <!-- PPD -->
                    <option value="KER">KER</option>
                    <option value="LP">LP</option>
                    <option value="BIO">BIO</option>
                </select>
            </div>

            <div class="filter-group">
                <span class="filter-label">Campaign Type</span>
                <select id="campaignFilter" onchange="updateDashboard()">
                    <option value="All">All</option>
                    <option value="Campaign">Campaign</option>
                    <option value="AlwaysOn">Always-On</option>
                </select>
            </div>
        </div>

        <!-- INSIGHT SUMMARY -->
        <div class="insight-panel">
            <h3>üìä Insight Summary (Illustrative)</h3>
            <ul class="insight-list" id="insightList">
                <!-- JS Populated -->
            </ul>
            <div class="disclaimer-text">
                These insights are illustrative and support analyst interpretation. They do NOT represent automated decisions.
            </div>
        </div>

        <!-- SECTION 1: TOPLINE -->
        <div class="section-header">
            <span>1. Topline Performance Overview</span>
        </div>
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-title">GMV <span class="tooltip-icon" title="Gross Merchandise Value">‚ìò</span></div>
                <div class="kpi-val" id="kpi-gmv">$0</div>
                <div class="kpi-trend trend-up">‚ñ≤ 12.5% MoM</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">Total Live Hours</div>
                <div class="kpi-val" id="kpi-hours">0h</div>
                <div class="kpi-trend trend-down">‚ñº 2.1% MoM</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">Sessions</div>
                <div class="kpi-val" id="kpi-sessions">0</div>
                <div class="kpi-trend trend-up">‚ñ≤ 5% MoM</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">Avg Session Duration</div>
                <div class="kpi-val" id="kpi-duration">0m</div>
                <div class="kpi-trend trend-up">‚ñ≤ 4% MoM</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">Views</div>
                <div class="kpi-val" id="kpi-views">0</div>
                <div class="kpi-trend trend-up">‚ñ≤ 8.4% MoM</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">Orders</div>
                <div class="kpi-val" id="kpi-orders">0</div>
                <div class="kpi-trend trend-up">‚ñ≤ 10% MoM</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">Conversion Rate</div>
                <div class="kpi-val" id="kpi-cvr">0%</div>
                <div class="kpi-trend trend-down">‚ñº 0.1% MoM</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">AOV</div>
                <div class="kpi-val" id="kpi-aov">$0</div>
                <div class="kpi-trend trend-up">‚ñ≤ 2% MoM</div>
            </div>
        </div>

        <div class="grid-2">
            <div class="panel-card">
                <div class="panel-title">GMV Trend</div>
                <div class="chart-wrapper">
                    <canvas id="chartGmvTrend"></canvas>
                </div>
            </div>
            <div class="panel-card">
                <div class="panel-title">Orders vs Sessions</div>
                <div class="chart-wrapper">
                    <canvas id="chartOrdersSessions"></canvas>
                </div>
            </div>
        </div>

        <!-- TOPLINE RAW TABLE -->
        <div class="panel-card" style="margin-bottom: 30px;">
            <div class="panel-title">Topline Performance Data Table</div>
            <div class="data-table-wrapper">
                <table id="toplineTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Platform</th>
                            <th>Division</th>
                            <th>Brand</th>
                            <th class="num-cell">GMV</th>
                            <th class="num-cell">Sessions</th>
                            <th class="num-cell">Live Hours</th>
                            <th class="num-cell">Orders</th>
                            <th class="num-cell">Views</th>
                            <th class="num-cell">AOV</th>
                            <th class="num-cell">CVR</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- SECTION 2: PRODUCTIVITY -->
        <div class="section-header">
            <span>2. Productivity & Efficiency Analysis</span>
        </div>
        <div class="kpi-grid">
            <div class="kpi-card" style="border-bottom: 4px solid var(--accent-teal);">
                <div class="kpi-title">GMV / Hour <span class="tooltip-icon" title="Primary Productivity Metric">‚ìò</span></div>
                <div class="kpi-val" id="kpi-prod">$0</div>
                <div class="kpi-trend trend-up">‚ñ≤ 5.2% MoM</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">GMV / Session</div>
                <div class="kpi-val" id="kpi-gmv-session">$0</div>
                <div class="kpi-trend trend-up">‚ñ≤ 3% MoM</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">Orders / Hour</div>
                <div class="kpi-val" id="kpi-orders-hour">0</div>
                <div class="kpi-trend trend-up">‚ñ≤ 6% MoM</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-title">Views / Hour</div>
                <div class="kpi-val" id="kpi-views-hour">0</div>
                <div class="kpi-trend trend-down">‚ñº 1% MoM</div>
            </div>
        </div>

        <div class="grid-2">
            <div class="panel-card">
                <div class="panel-title">GMV / Hour Trend</div>
                <div class="chart-wrapper">
                    <canvas id="chartProdTrend"></canvas>
                </div>
            </div>
            <div class="panel-card">
                <div class="panel-title">GMV / Hour by Division</div>
                <div class="chart-wrapper">
                    <canvas id="chartProdDiv"></canvas>
                </div>
            </div>
        </div>
        <div class="grid-2">
            <div class="panel-card">
                <div class="panel-title">GMV / Session</div>
                <div class="chart-wrapper">
                    <canvas id="chartGmvSession"></canvas>
                </div>
            </div>
            <div class="panel-card">
                <div class="panel-title">Orders / Hour</div>
                <div class="chart-wrapper">
                    <canvas id="chartOrdersHour"></canvas>
                </div>
            </div>
        </div>

        <!-- PRODUCTIVITY RAW TABLE -->
        <div class="panel-card" style="margin-bottom: 30px;">
            <div class="panel-title">Productivity Data Table</div>
            <div class="data-table-wrapper">
                <table id="prodTable">
                    <thead>
                        <tr>
                            <th>Division</th>
                            <th>Brand</th>
                            <th class="num-cell">GMV</th>
                            <th class="num-cell">Live Hours</th>
                            <th class="num-cell">Sessions</th>
                            <th class="num-cell">GMV / Hour</th>
                            <th class="num-cell">GMV / Session</th>
                            <th class="num-cell">Orders / Hour</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- SECTION 3: DIVISION & BRAND PERFORMANCE -->
        <div class="section-header">
            <span>3. Division & Brand Performance</span>
        </div>
        <div class="grid-2">
            <div class="panel-card">
                <div class="panel-title">Division GMV Contribution</div>
                <div class="chart-wrapper">
                    <canvas id="chartDivContrib"></canvas>
                </div>
            </div>
            <div class="panel-card">
                <div class="panel-title">Brand GMV / Hour Ranking</div>
                <div class="chart-wrapper">
                    <canvas id="chartBrandRank"></canvas>
                </div>
            </div>
        </div>
        <div class="grid-1">
            <div class="panel-card">
                <div class="panel-title">
                    <span>Brand Trend Comparison</span>
                    <div>
                        <select id="brandComp1" class="inline-select" onchange="updateBrandTrend()">
                            <option value="MNY">MNY</option>
                            <option value="GAR">GAR</option>
                            <option value="OAP">OAP</option>
                            <option value="3CE">3CE</option>
                            <option value="LRP">LRP</option>
                            <option value="CRV">CRV</option>
                            <option value="KER">KER</option>
                            <option value="LP">LP</option>
                            <option value="BIO">BIO</option>
                        </select> vs 
                        <select id="brandComp2" class="inline-select" onchange="updateBrandTrend()">
                            <option value="LRP" selected>LRP</option>
                            <option value="MNY">MNY</option>
                            <option value="GAR">GAR</option>
                            <option value="OAP">OAP</option>
                            <option value="3CE">3CE</option>
                            <option value="CRV">CRV</option>
                            <option value="KER">KER</option>
                            <option value="LP">LP</option>
                            <option value="BIO">BIO</option>
                        </select>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="chartBrandTrend"></canvas>
                </div>
            </div>
        </div>
        
        <!-- BRAND RAW TABLE -->
        <div class="panel-card" style="margin-bottom: 30px;">
            <div class="panel-title">Division & Brand Performance Table</div>
            <div class="data-table-wrapper">
                <table id="brandTable">
                    <thead>
                        <tr>
                            <th>Division</th>
                            <th>Brand</th>
                            <th class="num-cell">GMV ($)</th>
                            <th class="num-cell">Live Hours</th>
                            <th class="num-cell">GMV / Hour</th>
                            <th class="num-cell">Contribution %</th>
                            <th class="num-cell">MoM GMV %</th>
                            <th class="num-cell">Campaign GMV %</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- SECTION 4: OPERATIONAL & ENGAGEMENT -->
        <div class="section-header">
            <span>4. Operational & Engagement Metrics</span>
            <span style="font-size: 0.8rem; color: #666; font-weight: 400;">*Brand filters excluded from operational view</span>
        </div>
        <div class="grid-2">
            <div class="panel-card">
                <div class="panel-title">
                    Room Utilization Over Time
                    <div class="multi-select-hack" style="font-size: 0.8rem; border:1px solid #ccc; padding:2px 5px; border-radius:3px;">
                        Comparison: Room A, Room B
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="chartRoomLine"></canvas>
                </div>
            </div>
            <div class="panel-card">
                <div class="panel-title">Hourly Productivity Heatmap</div>
                <div class="chart-wrapper" style="overflow: hidden; display: flex; flex-direction: column;">
                    <div id="heatmapContainer" class="heatmap" style="flex: 1; align-content: center;">
                        <!-- JS Generated -->
                    </div>
                    <div style="text-align: center; font-size: 0.7rem; color: #999; margin-top:5px;">X-Axis: Hour (0-23) | Y-Axis: Day</div>
                </div>
            </div>
        </div>
        <div class="grid-1">
            <div class="panel-card">
                <div class="panel-title">Engagement Rate Trend</div>
                <div class="chart-wrapper">
                    <canvas id="chartEngagementTrend"></canvas>
                </div>
            </div>
        </div>

        <!-- OPERATIONAL RAW TABLE -->
        <div class="panel-card" style="margin-bottom: 30px;">
            <div class="panel-title">Operational Data Table</div>
            <div class="data-table-wrapper">
                <table id="opsTable">
                    <thead>
                        <tr>
                            <th>Room</th>
                            <th>EBA</th>
                            <th>Date</th>
                            <th class="num-cell">Live Hours</th>
                            <th class="num-cell">GMV</th>
                            <th class="num-cell">GMV / Hour</th>
                            <th class="num-cell">Engagement Rate</th>
                            <th class="num-cell">Watch Time</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- SECTION 5: PERFORMANCE EVOLUTION (EVO) -->
        <div class="section-header">
            <span>5. Performance Evolution (EVO)</span>
        </div>
        <div class="grid-2">
            <div class="panel-card">
                <div class="panel-title">MoM GMV Change (%)</div>
                <div class="chart-wrapper">
                    <canvas id="chartMomGmv"></canvas>
                </div>
            </div>
            <div class="panel-card">
                <div class="panel-title">MoM GMV / Hour Change (%)</div>
                <div class="chart-wrapper">
                    <canvas id="chartMomProd"></canvas>
                </div>
            </div>
        </div>
        <div class="grid-1">
            <div class="panel-card">
                <div class="panel-title">Campaign vs Always-On EVO</div>
                <div class="chart-wrapper">
                    <canvas id="chartCampEvo"></canvas>
                </div>
            </div>
        </div>

        <!-- EVO RAW TABLE -->
        <div class="panel-card" style="margin-bottom: 30px;">
            <div class="panel-title">Performance Evolution Table</div>
            <div class="data-table-wrapper">
                <table id="evoTable">
                    <thead>
                        <tr>
                            <th>Period</th>
                            <th class="num-cell">GMV</th>
                            <th class="num-cell">GMV / Hour</th>
                            <th class="num-cell">MoM GMV %</th>
                            <th class="num-cell">MoM Productivity %</th>
                            <th>Campaign Flag</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        <!-- SECTION 6: GOVERNANCE -->
        <div class="governance-section">
            <div class="accordion-header" onclick="toggleAccordion('govContent')">
                <span>‚öñÔ∏è KPI Governance & Standardization</span>
                <span>‚ñº</span>
            </div>
            <div id="govContent" class="accordion-content">
                <div class="def-grid">
                    <div class="def-item">
                        <h4>GMV (Gross Merchandise Value)</h4>
                        <p>Total value of merchandise sold over a given period of time before deduction of any fees or expenses.</p>
                    </div>
                    <div class="def-item">
                        <h4>GMV / Hour (Productivity)</h4>
                        <p>Total GMV divided by Total Live Broadcast Hours. The primary north star metric for efficiency.</p>
                    </div>
                    <div class="def-item">
                        <h4>Campaign Flag</h4>
                        <p>Sessions tagged as 'Campaign' are manually validated against the marketing calendar (e.g., 9.9, Payday).</p>
                    </div>
                    <div class="def-item">
                        <h4>EVO (Evolution)</h4>
                        <p>Comparative performance movement over time, typically measured Month-on-Month or Period-over-Period.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 7: DECISION ENABLEMENT -->
        <div class="enablement-section">
            <div class="accordion-header" onclick="toggleAccordion('decContent')" style="background: #e3f2fd; color: #0d47a1;">
                <span>üöÄ Decision Enablement Signals (Illustrative)</span>
                <span>‚ñº</span>
            </div>
            <div id="decContent" class="accordion-content active">
                <div class="data-table-wrapper">
                    <table id="signalTable">
                        <thead>
                            <tr>
                                <th>Signal Type</th>
                                <th>Trigger Metric</th>
                                <th>Threshold</th>
                                <th>Observed Value</th>
                                <th>Recommended Review Action</th>
                            </tr>
                        </thead>
                        <tbody><!-- JS Populated --></tbody>
                    </table>
                </div>
                <div class="disclaimer-text">
                    Signals are informational and support human-led decisions.
                </div>
            </div>
        </div>

        <!-- SECTION 8: RAW DATA TRANSPARENCY (APPENDIX) -->
        <div class="section-header">
            <span>8. Underlying Raw Data (Illustrative)</span>
        </div>
        <div class="panel-card" style="background: #fafafa; border: 1px dashed #ccc;">
            <div class="panel-title" style="color: #666;">Data Transparency Appendix</div>
            <div style="font-size: 0.8rem; color: #666; margin-bottom: 10px;">
                This section serves as a data audit trail, mirroring the appendix of agency reports.
            </div>
            <div style="height: 150px; overflow-y: scroll; border: 1px solid #eee; background: white; padding: 10px;">
                <code id="rawJsonPreview" style="font-size: 0.7rem; color: #333;">
                    <!-- Raw Data Preview -->
                </code>
            </div>
        </div>

    </div>

    <footer>
        <p>This dashboard is an illustrative example of reporting enablement.</p>
        <p>All data is simulated to mirror L'Or√©al agency reporting structure.</p>
        <p>Insights support ‚Äî not replace ‚Äî human judgment.</p>
        <p>&copy; 2026 L'Or√©al Performance Analytics Enablement</p>
    </footer>

    <script>
        // ==========================================
        // 1. CONFIGURATION & THEME
        // ==========================================
        const theme = {
            blue: '#1F3B6B',
            teal: '#2BAE9F',
            lightTeal: 'rgba(43, 174, 159, 0.2)',
            grey: '#e0e0e0',
            shopee: '#ee4d2d',
            tiktok: '#000000'
        };

        Chart.defaults.font.family = "'Segoe UI', sans-serif";
        Chart.defaults.color = '#666';
        Chart.defaults.scale.grid.color = '#f0f0f0';
        Chart.defaults.responsive = true;
        Chart.defaults.maintainAspectRatio = false;

        // ==========================================
        // 2. DATA GENERATION (Simulated Backend)
        // ==========================================
        // Hierarchy Structure
        const brandHierarchy = {
            "CPD": ["MNY", "GAR", "OAP", "3CE"],
            "LDP": ["LRP", "CRV"],
            "PPD": ["KER", "LP", "BIO"]
        };
        const ebas = ["Sarah", "Mike", "Jessica", "David", "Alex"];
        const rooms = ["Room A", "Room B", "Room C", "Studio 1"];
        const platforms = ["Shopee", "TikTok"];
        const types = ["Campaign", "AlwaysOn"];

        let masterData = [];

        function initData() {
            // Generate 30 days of data
            for (let i = 1; i <= 30; i++) {
                // Generate varied sessions per day (e.g., 8 to 15) to make charts dynamic
                const dailySessionCount = Math.floor(Math.random() * 8) + 8; 
                for (let j = 0; j < dailySessionCount; j++) {
                    const divKeys = Object.keys(brandHierarchy);
                    const div = divKeys[Math.floor(Math.random() * divKeys.length)];
                    const brands = brandHierarchy[div];
                    const brand = brands[Math.floor(Math.random() * brands.length)];
                    
                    const eba = ebas[Math.floor(Math.random() * ebas.length)];
                    const room = rooms[Math.floor(Math.random() * rooms.length)];
                    const plat = platforms[Math.floor(Math.random() * platforms.length)];
                    const type = Math.random() > 0.7 ? "Campaign" : "AlwaysOn";
                    
                    // Logic: Campaigns perform better
                    const baseGMV = type === "Campaign" ? 6000 : 2000;
                    
                    const hours = 2 + Math.random() * 4; // 2-6 hours
                    const gmv = (baseGMV * hours) * (0.8 + Math.random() * 0.4);
                    const views = (gmv / 2) + Math.random() * 1000;
                    const orders = (views * 0.05) * (0.8 + Math.random() * 0.4);
                    const engagement = 0.05 + (Math.random() * 0.1); // 5% - 15%
                    const watchTime = 30 + (Math.random() * 120); // seconds

                    masterData.push({
                        date: `2025-10-${i.toString().padStart(2, '0')}`,
                        day: i,
                        division: div,
                        brand: brand,
                        eba: eba,
                        room: room,
                        platform: plat,
                        type: type,
                        hours: hours,
                        gmv: gmv,
                        views: Math.floor(views),
                        orders: Math.floor(orders),
                        engagement: engagement,
                        watchTime: watchTime
                    });
                }
            }
            
            // Show raw data in appendix
            document.getElementById('rawJsonPreview').innerText = JSON.stringify(masterData.slice(0, 5), null, 2) + "\n... (" + masterData.length + " total records)";
        }

        // ==========================================
        // 3. STATE & CHART INSTANCES
        // ==========================================
        let charts = {}; 

        // ==========================================
        // 4. MAIN RENDER LOGIC
        // ==========================================
        document.addEventListener('DOMContentLoaded', () => {
            initData();
            initCharts();
            generateHeatmap();
            updateDashboard();
        });

        function updateDashboard() {
            // 1. Get Filter Values
            const dateRange = document.getElementById('dateFilter').value;
            const platform = document.querySelector('input[name="platform"]:checked').value;
            const division = document.getElementById('divisionFilter').value;
            const brand = document.getElementById('brandFilter').value;
            const campType = document.getElementById('campaignFilter').value;

            // 2. Filter Data
            const filteredData = masterData.filter(d => {
                const matchPlat = platform === 'All' || d.platform === platform;
                const matchDiv = division === 'All' || d.division === division;
                const matchBrand = brand === 'All' || d.brand === brand;
                const matchCamp = campType === 'All' || d.type === campType;
                return matchPlat && matchDiv && matchBrand && matchCamp;
            });

            // 3. Calc Topline KPIs
            const totalGMV = filteredData.reduce((sum, d) => sum + d.gmv, 0);
            const totalHours = filteredData.reduce((sum, d) => sum + d.hours, 0);
            const totalSessions = filteredData.length;
            const totalViews = filteredData.reduce((sum, d) => sum + d.views, 0);
            const totalOrders = filteredData.reduce((sum, d) => sum + d.orders, 0);
            const productivity = totalHours > 0 ? totalGMV / totalHours : 0;
            const cvr = totalViews > 0 ? (totalOrders / totalViews) * 100 : 0;
            const avgDur = totalSessions > 0 ? (totalHours * 60) / totalSessions : 0;
            const aov = totalOrders > 0 ? totalGMV / totalOrders : 0;
            const gmvPerSession = totalSessions > 0 ? totalGMV / totalSessions : 0;
            const ordersPerHour = totalHours > 0 ? totalOrders / totalHours : 0;
            const viewsPerHour = totalHours > 0 ? totalViews / totalHours : 0;

            // Update DOM
            document.getElementById('kpi-gmv').innerText = formatCurrency(totalGMV);
            document.getElementById('kpi-prod').innerText = formatCurrency(productivity);
            document.getElementById('kpi-hours').innerText = Math.round(totalHours) + 'h';
            document.getElementById('kpi-sessions').innerText = totalSessions;
            document.getElementById('kpi-duration').innerText = Math.round(avgDur) + 'm';
            document.getElementById('kpi-views').innerText = formatNumber(totalViews);
            document.getElementById('kpi-orders').innerText = formatNumber(totalOrders);
            document.getElementById('kpi-cvr').innerText = cvr.toFixed(2) + '%';
            document.getElementById('kpi-aov').innerText = formatCurrency(aov);

            // Prod Section KPIs
            document.getElementById('kpi-gmv-session').innerText = formatCurrency(gmvPerSession);
            document.getElementById('kpi-orders-hour').innerText = formatNumber(ordersPerHour);
            document.getElementById('kpi-views-hour').innerText = formatNumber(viewsPerHour);

            // 4. Generate Text Insights & Signals
            generateInsights(platform, brand, productivity);
            generateSignals(productivity, campType);

            // 5. Update Charts
            updateToplineCharts(filteredData);
            updateProductivityCharts(filteredData);
            updateBrandCharts(filteredData);
            updateOperationalCharts(masterData); // Operational view uses less filtering
            updateEvoCharts(filteredData);
            
            // 6. Update Tables
            updateToplineTable(filteredData);
            updateProductivityTable(filteredData);
            updateBrandTable(filteredData);
            updateOpsTable(masterData);
            updateEvoTable(filteredData);
        }

        // ==========================================
        // 5. TABLE UPDATES (RAW DATA VIEW)
        // ==========================================
        function updateToplineTable(data) {
            // Aggregate by Date/Plat/Div/Brand for Topline view
            const tbody = document.querySelector('#toplineTable tbody');
            tbody.innerHTML = '';
            // Limit to top 10 for performance in illustrative example
            const subset = data.slice(0, 10);
            
            subset.forEach(d => {
                const prod = d.hours > 0 ? d.gmv / d.hours : 0;
                const aov = d.orders > 0 ? d.gmv / d.orders : 0;
                const cvr = d.views > 0 ? (d.orders / d.views) * 100 : 0;
                
                const row = `<tr>
                    <td>${d.date}</td>
                    <td>${d.platform}</td>
                    <td>${d.division}</td>
                    <td>${d.brand}</td>
                    <td class="num-cell">${formatCurrency(d.gmv)}</td>
                    <td class="num-cell">1</td>
                    <td class="num-cell">${d.hours.toFixed(1)}</td>
                    <td class="num-cell">${d.orders}</td>
                    <td class="num-cell">${d.views}</td>
                    <td class="num-cell">${formatCurrency(aov)}</td>
                    <td class="num-cell">${cvr.toFixed(2)}%</td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function updateProductivityTable(data) {
            const tbody = document.querySelector('#prodTable tbody');
            tbody.innerHTML = '';
            
            const grouped = {};
            data.forEach(d => {
                const k = d.division + '|' + d.brand;
                if(!grouped[k]) grouped[k] = {div: d.division, brand: d.brand, gmv: 0, hours: 0, sessions: 0, orders: 0};
                grouped[k].gmv += d.gmv;
                grouped[k].hours += d.hours;
                grouped[k].sessions += 1;
                grouped[k].orders += d.orders;
            });

            Object.values(grouped).forEach(g => {
                const prod = g.hours > 0 ? g.gmv / g.hours : 0;
                const gmvSess = g.sessions > 0 ? g.gmv / g.sessions : 0;
                const ordHour = g.hours > 0 ? g.orders / g.hours : 0;
                
                const row = `<tr>
                    <td>${g.div}</td>
                    <td>${g.brand}</td>
                    <td class="num-cell">${formatCurrency(g.gmv)}</td>
                    <td class="num-cell">${g.hours.toFixed(1)}</td>
                    <td class="num-cell">${g.sessions}</td>
                    <td class="num-cell">${formatCurrency(prod)}</td>
                    <td class="num-cell">${formatCurrency(gmvSess)}</td>
                    <td class="num-cell">${ordHour.toFixed(1)}</td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function updateBrandTable(data) {
            const tbody = document.querySelector('#brandTable tbody');
            tbody.innerHTML = '';

            const grouped = {};
            let totalGMV = 0;
            data.forEach(d => {
                totalGMV += d.gmv;
                const k = d.division + '|' + d.brand;
                if (!grouped[k]) grouped[k] = { div: d.division, brand: d.brand, gmv: 0, hours: 0, campGMV: 0 };
                grouped[k].gmv += d.gmv;
                grouped[k].hours += d.hours;
                if(d.type === 'Campaign') grouped[k].campGMV += d.gmv;
            });

            Object.values(grouped).forEach(g => {
                const prod = g.hours > 0 ? g.gmv / g.hours : 0;
                const contrib = totalGMV > 0 ? (g.gmv / totalGMV) * 100 : 0;
                const campShare = g.gmv > 0 ? (g.campGMV / g.gmv) * 100 : 0;
                const mom = (Math.random() * 20) - 5; 

                const row = `<tr>
                    <td>${g.div}</td>
                    <td>${g.brand}</td>
                    <td class="num-cell">${formatCurrency(g.gmv)}</td>
                    <td class="num-cell">${g.hours.toFixed(1)}</td>
                    <td class="num-cell">${formatCurrency(prod)}</td>
                    <td class="num-cell">${contrib.toFixed(1)}%</td>
                    <td class="num-cell" style="color:${mom>=0?'green':'red'}">${mom.toFixed(1)}%</td>
                    <td class="num-cell">${campShare.toFixed(1)}%</td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function updateOpsTable(data) {
            const tbody = document.querySelector('#opsTable tbody');
            tbody.innerHTML = '';
            
            // Limit to top 15 for demo
            data.slice(0, 15).forEach(d => {
                const prod = d.hours > 0 ? d.gmv / d.hours : 0;
                const row = `<tr>
                    <td>${d.room}</td>
                    <td>${d.eba}</td>
                    <td>${d.date}</td>
                    <td class="num-cell">${d.hours.toFixed(1)}</td>
                    <td class="num-cell">${formatCurrency(d.gmv)}</td>
                    <td class="num-cell">${formatCurrency(prod)}</td>
                    <td class="num-cell">${(d.engagement*100).toFixed(1)}%</td>
                    <td class="num-cell">${Math.round(d.watchTime)}s</td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function updateEvoTable(data) {
            const tbody = document.querySelector('#evoTable tbody');
            tbody.innerHTML = '';
            
            // Group by Week for demo evolution
            const weeks = {};
            data.forEach(d => {
                const w = 'W' + Math.ceil(d.day / 7);
                if(!weeks[w]) weeks[w] = {gmv: 0, hours: 0, camp: false};
                weeks[w].gmv += d.gmv;
                weeks[w].hours += d.hours;
                if(d.type === 'Campaign') weeks[w].camp = true;
            });

            let prevGMV = 0;
            let prevProd = 0;

            Object.keys(weeks).sort().forEach(w => {
                const g = weeks[w];
                const prod = g.hours > 0 ? g.gmv / g.hours : 0;
                const momGMV = prevGMV > 0 ? ((g.gmv - prevGMV) / prevGMV) * 100 : 0;
                const momProd = prevProd > 0 ? ((prod - prevProd) / prevProd) * 100 : 0;
                
                prevGMV = g.gmv;
                prevProd = prod;

                const row = `<tr>
                    <td>${w}</td>
                    <td class="num-cell">${formatCurrency(g.gmv)}</td>
                    <td class="num-cell">${formatCurrency(prod)}</td>
                    <td class="num-cell" style="color:${momGMV>=0?'green':'red'}">${momGMV.toFixed(1)}%</td>
                    <td class="num-cell" style="color:${momProd>=0?'green':'red'}">${momProd.toFixed(1)}%</td>
                    <td>${g.camp ? 'Yes' : 'No'}</td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        // ==========================================
        // 6. CHART UPDATES
        // ==========================================
        function updateToplineCharts(data) {
            // GMV Trend
            const days = Array.from({length: 30}, (_, i) => i + 1);
            const dailyGMV = new Array(30).fill(0);
            data.forEach(d => dailyGMV[d.day - 1] += d.gmv);
            
            charts.gmvTrend.data.labels = days;
            charts.gmvTrend.data.datasets[0].data = dailyGMV;
            charts.gmvTrend.update();

            // Orders vs Sessions
            const dailyOrders = new Array(30).fill(0);
            const dailySess = new Array(30).fill(0);
            data.forEach(d => {
                dailyOrders[d.day - 1] += d.orders;
                dailySess[d.day - 1] += 1;
            });
            
            charts.ordersSessions.data.labels = days;
            charts.ordersSessions.data.datasets[0].data = dailyOrders;
            charts.ordersSessions.data.datasets[1].data = dailySess;
            charts.ordersSessions.update();
        }

        function updateProductivityCharts(data) {
            // Prod Trend
            const days = Array.from({length: 30}, (_, i) => i + 1);
            const dailyGMV = new Array(30).fill(0);
            const dailyHours = new Array(30).fill(0);
            data.forEach(d => {
                dailyGMV[d.day-1] += d.gmv;
                dailyHours[d.day-1] += d.hours;
            });
            const dailyProd = dailyGMV.map((gmv, i) => dailyHours[i] > 0 ? gmv/dailyHours[i] : 0);
            
            charts.prodTrend.data.labels = days;
            charts.prodTrend.data.datasets[0].data = dailyProd;
            charts.prodTrend.update();

            // By Division
            const divs = ['CPD', 'LDP', 'PPD'];
            const divProd = divs.map(div => {
                const subset = data.filter(d => d.division === div);
                const g = subset.reduce((s, d) => s + d.gmv, 0);
                const h = subset.reduce((s, d) => s + d.hours, 0);
                return h > 0 ? g/h : 0;
            });
            charts.prodDiv.data.datasets[0].data = divProd;
            charts.prodDiv.update();

            // GMV/Session
            const sessProd = divs.map(div => {
                const subset = data.filter(d => d.division === div);
                const g = subset.reduce((s, d) => s + d.gmv, 0);
                return subset.length > 0 ? g/subset.length : 0;
            });
            charts.gmvSession.data.datasets[0].data = sessProd;
            charts.gmvSession.update();

            // Orders/Hour
            const ordProd = divs.map(div => {
                const subset = data.filter(d => d.division === div);
                const o = subset.reduce((s, d) => s + d.orders, 0);
                const h = subset.reduce((s, d) => s + d.hours, 0);
                return h > 0 ? o/h : 0;
            });
            charts.ordersHour.data.datasets[0].data = ordProd;
            charts.ordersHour.update();
        }

        function updateBrandCharts(data) {
            // Stacked Bar (Div Contribution)
            const divs = ['CPD', 'LDP', 'PPD'];
            const totals = divs.map(div => data.filter(d => d.division === div).reduce((s, d) => s + d.gmv, 0));
            charts.divContrib.data.datasets[0].data = totals;
            charts.divContrib.update();

            // Ranking
            const brandList = ["MNY", "GAR", "OAP", "LRP", "CRV", "KER", "LP"];
            const brandProds = brandList.map(b => {
                const subset = data.filter(d => d.brand === b);
                const g = subset.reduce((s, d) => s + d.gmv, 0);
                const h = subset.reduce((s, d) => s + d.hours, 0);
                return h > 0 ? g/h : 0;
            });
            charts.brandRank.data.labels = brandList;
            charts.brandRank.data.datasets[0].data = brandProds;
            charts.brandRank.update();

            updateBrandTrend();
        }

        function updateBrandTrend() {
            const b1 = document.getElementById('brandComp1').value;
            const b2 = document.getElementById('brandComp2').value;
            // Generate deterministic fake trend
            const genTrend = (seed) => Array.from({length: 4}, () => 1500 + (seed * 100) + Math.random() * 500);
            
            charts.brandTrend.data.datasets[0].label = b1;
            charts.brandTrend.data.datasets[0].data = genTrend(b1.length);
            charts.brandTrend.data.datasets[1].label = b2;
            charts.brandTrend.data.datasets[1].data = genTrend(b2.length);
            charts.brandTrend.update();
        }

        function updateOperationalCharts(data) {
            // Room Line
            charts.roomLine.data.datasets.forEach(ds => {
                ds.data = Array.from({length: 7}, () => 40 + Math.random() * 50); // % utilization
            });
            charts.roomLine.update();

            // Engagement Trend
            const days = Array.from({length: 30}, (_, i) => i + 1);
            const eng = days.map(() => 0.05 + Math.random() * 0.1);
            charts.engTrend.data.labels = days;
            charts.engTrend.data.datasets[0].data = eng;
            charts.engTrend.update();
        }

        function updateEvoCharts(data) {
            const weeks = ['W1', 'W2', 'W3', 'W4'];
            // Fake MoM Data
            charts.momGmv.data.datasets[0].data = [5, -2, 8, 12];
            charts.momGmv.update();
            charts.momProd.data.datasets[0].data = [2, -1, 5, 8];
            charts.momProd.update();
            
            charts.campEvo.data.datasets[0].data = [10, 15, 8, 20]; // Camp
            charts.campEvo.data.datasets[1].data = [2, 1, 3, 2]; // AO
            charts.campEvo.update();
        }

        // ==========================================
        // 7. CHART INIT
        // ==========================================
        function initCharts() {
            // Topline
            charts.gmvTrend = new Chart(document.getElementById('chartGmvTrend'), {
                type: 'line', data: { labels: [], datasets: [{ label: 'GMV', data: [], borderColor: theme.blue, tension: 0.4 }] }
            });
            charts.ordersSessions = new Chart(document.getElementById('chartOrdersSessions'), {
                type: 'line', data: { labels: [], datasets: [
                    { label: 'Orders', data: [], borderColor: theme.teal, yAxisID: 'y' },
                    { label: 'Sessions', data: [], borderColor: theme.grey, yAxisID: 'y1' }
                ]},
                options: { scales: { y: {position:'left'}, y1: {position:'right'} } }
            });

            // Productivity
            charts.prodTrend = new Chart(document.getElementById('chartProdTrend'), {
                type: 'line', data: { labels: [], datasets: [{ label: 'GMV/Hr', data: [], borderColor: theme.blue }] }
            });
            charts.prodDiv = new Chart(document.getElementById('chartProdDiv'), {
                type: 'bar', data: { labels: ['CPD', 'LDP', 'PPD'], datasets: [{ label: 'GMV/Hr', data: [], backgroundColor: theme.teal }] }
            });
            charts.gmvSession = new Chart(document.getElementById('chartGmvSession'), {
                type: 'bar', data: { labels: ['CPD', 'LDP', 'PPD'], datasets: [{ label: 'GMV/Sess', data: [], backgroundColor: theme.blue }] }
            });
            charts.ordersHour = new Chart(document.getElementById('chartOrdersHour'), {
                type: 'bar', data: { labels: ['CPD', 'LDP', 'PPD'], datasets: [{ label: 'Orders/Hr', data: [], backgroundColor: theme.grey }] }
            });

            // Brand
            charts.divContrib = new Chart(document.getElementById('chartDivContrib'), {
                type: 'bar', data: { labels: ['CPD', 'LDP', 'PPD'], datasets: [{ label: 'GMV', data: [], backgroundColor: [theme.blue, theme.teal, theme.grey] }] }
            });
            charts.brandRank = new Chart(document.getElementById('chartBrandRank'), {
                type: 'bar', data: { labels: [], datasets: [{ label: 'GMV/Hr', data: [], backgroundColor: theme.blue }] },
                options: { indexAxis: 'y' }
            });
            charts.brandTrend = new Chart(document.getElementById('chartBrandTrend'), {
                type: 'line', data: { labels: ['W1', 'W2', 'W3', 'W4'], datasets: [{ label: 'B1', borderColor: theme.blue }, { label: 'B2', borderColor: theme.teal }] }
            });

            // Ops
            charts.roomLine = new Chart(document.getElementById('chartRoomLine'), {
                type: 'line', data: { labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'], datasets: [
                    { label: 'Room A', borderColor: theme.blue }, { label: 'Room B', borderColor: theme.teal }
                ] }
            });
            charts.engTrend = new Chart(document.getElementById('chartEngagementTrend'), {
                type: 'line', data: { labels: [], datasets: [{ label: 'Eng Rate', borderColor: theme.shopee }] }
            });

            // EVO
            charts.momGmv = new Chart(document.getElementById('chartMomGmv'), {
                type: 'bar', data: { labels: ['W1', 'W2', 'W3', 'W4'], datasets: [{ label: 'MoM %', backgroundColor: theme.blue }] }
            });
            charts.momProd = new Chart(document.getElementById('chartMomProd'), {
                type: 'bar', data: { labels: ['W1', 'W2', 'W3', 'W4'], datasets: [{ label: 'MoM %', backgroundColor: theme.teal }] }
            });
            charts.campEvo = new Chart(document.getElementById('chartCampEvo'), {
                type: 'bar', data: { labels: ['W1', 'W2', 'W3', 'W4'], datasets: [
                    { label: 'Campaign', backgroundColor: theme.blue }, { label: 'Always-On', backgroundColor: theme.grey }
                ]}
            });
        }

        // ==========================================
        // 8. HELPERS & INSIGHTS
        // ==========================================
        function generateHeatmap() {
            const container = document.getElementById('heatmapContainer');
            container.innerHTML = '';
            // Header Row
            container.appendChild(document.createElement('div')); 
            for(let i=0; i<24; i++) {
                let div = document.createElement('div');
                div.className = 'hm-header';
                div.innerText = i;
                container.appendChild(div);
            }
            // Rows
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            days.forEach(d => {
                let label = document.createElement('div');
                label.className = 'hm-label';
                label.innerText = d;
                container.appendChild(label);
                for(let i=0; i<24; i++) {
                    let cell = document.createElement('div');
                    cell.className = 'hm-cell';
                    let alpha = 0.1;
                    if(i >= 18 && i <= 22) alpha = 0.6 + (Math.random() * 0.4);
                    cell.style.backgroundColor = `rgba(31, 59, 107, ${alpha})`;
                    container.appendChild(cell);
                }
            });
        }

        function generateInsights(plat, brand, prod) {
            const list = document.getElementById('insightList');
            list.innerHTML = '';
            const insights = [
                `Productivity trend shows a <strong>5% lift</strong> in sessions during Campaign days vs Always-on.`,
                `${brand === 'All' ? "L'Or√©al Paris" : brand} is driving the highest GMV contribution this month.`,
                `Room C utilization dropped by 15%, suggesting potential for schedule optimization.`,
                `MoM EVO indicates a <strong>12% growth</strong> in GMV / Hour across PPD division.`
            ];
            insights.forEach(txt => {
                const li = document.createElement('li');
                li.innerHTML = txt;
                list.appendChild(li);
            });
        }

        function generateSignals(prod, type) {
            const tbody = document.querySelector('#signalTable tbody');
            tbody.innerHTML = '';
            const signals = [
                { t: 'Productivity Decline', m: 'GMV/Hour', th: '< $1,000', o: '$950', a: 'Review session structure & host performance.' },
                { t: 'Campaign Underperformance', m: 'Campaign GMV', th: 'vs Baseline', o: '-5%', a: 'Reassess campaign allocation & promotion mix.' },
                { t: 'Resource Inefficiency', m: 'Live Hours', th: '> 5h with Low GMV', o: '6h / $500', a: 'Optimize resource usage & room booking.' },
                { t: 'Division Concentration', m: 'GMV Share', th: '> 60% Single Div', o: '65% CPD', a: 'Review portfolio mix for balance.' }
            ];
            signals.forEach(s => {
                const row = `<tr>
                    <td><strong>${s.t}</strong></td>
                    <td>${s.m}</td>
                    <td>${s.th}</td>
                    <td style="color: red;">${s.o}</td>
                    <td>${s.a}</td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        function toggleAccordion(id) {
            document.getElementById(id).classList.toggle('active');
        }

        function formatCurrency(val) {
            return '$' + Math.round(val).toLocaleString();
        }
        function formatNumber(val) {
            return Math.round(val).toLocaleString();
        }

    </script>
</body>
</html>